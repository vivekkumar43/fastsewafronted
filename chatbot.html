<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FastSewa AI Chatbot</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --primary: #2563eb;
  --dark: #1f2937;
  --border: #e5e7eb;
}

.fastsewa-chatbot-toggle{
  position:fixed;bottom:25px;right:25px;
  width:60px;height:60px;border-radius:50%;
  background:var(--primary);color:#fff;
  border:none;font-size:22px;cursor:pointer;
}

.fastsewa-chatbot-container{
  position:fixed;bottom:100px;right:25px;
  width:380px;height:580px;background:#fff;
  display:none;flex-direction:column;
  border-radius:12px;border:1px solid var(--border);
}

.fastsewa-chatbot-header{
  background:var(--primary);color:#fff;
  padding:16px;display:flex;
  justify-content:space-between;
}

.fastsewa-chatbot-body{
  flex:1;overflow-y:auto;padding:16px;
  background:#fafafa;display:flex;
  flex-direction:column;gap:12px;
}

.fastsewa-message{
  max-width:85%;padding:12px 16px;
  border-radius:18px;font-size:14px;
}

.fastsewa-bot-message{
  background:#fff;border:1px solid var(--border);
  align-self:flex-start;
}

.fastsewa-user-message{
  background:var(--primary);color:#fff;
  align-self:flex-end;
}

.service-buttons{
  display:grid;grid-template-columns:1fr 1fr;
  gap:10px;margin-top:10px;
}

.service-btn{
  padding:10px;border-radius:10px;
  border:1px solid var(--border);
  background:#fff;cursor:pointer;
  font-size:13px;
}

.service-btn:hover{background:#f3f4f6}

.fastsewa-chatbot-footer{
  padding:12px;border-top:1px solid var(--border);
  display:flex;gap:8px;
}

.fastsewa-chatbot-input{
  flex:1;padding:10px;border-radius:20px;
  border:1px solid var(--border);
}

.fastsewa-chatbot-send-btn{
  width:42px;height:42px;border-radius:50%;
  border:none;background:var(--primary);color:#fff;
}

.pdf-download-btn{
  background:#10b981;color:#fff;
  padding:8px 14px;border-radius:16px;
  text-decoration:none;font-size:13px;
}
</style>
</head>

<body>

<button class="fastsewa-chatbot-toggle" id="toggleBtn">
  <i class="fas fa-headset"></i>
</button>

<div class="fastsewa-chatbot-container" id="chatbox">

  <div class="fastsewa-chatbot-header">
    <b>FastSewa Assistant</b>
    <button onclick="chatbox.style.display='none'" style="background:none;border:none;color:#fff">‚úï</button>
  </div>

  <div class="fastsewa-chatbot-body" id="chatBody"></div>

  <div class="fastsewa-chatbot-footer">
    <input id="chatInput" class="fastsewa-chatbot-input" placeholder="Type message..." />
    <button class="fastsewa-chatbot-send-btn" onclick="sendMessage()">
      <i class="fas fa-paper-plane"></i>
    </button>
  </div>
</div>

<script>
const API = "http://localhost:5000/api";
const chatbox = document.getElementById("chatbox");
const chatBody = document.getElementById("chatBody");
const input = document.getElementById("chatInput");

document.getElementById("toggleBtn").onclick = ()=>{
  chatbox.style.display = chatbox.style.display==="flex"?"none":"flex";
};

function addMsg(text, type){
  const div = document.createElement("div");
  div.className = "fastsewa-message "+(type==="bot"?"fastsewa-bot-message":"fastsewa-user-message");
  div.innerHTML = text;
  chatBody.appendChild(div);
  chatBody.scrollTop = chatBody.scrollHeight;
}

function showServiceButtons(){
  const div = document.createElement("div");
  div.className = "service-buttons";
  div.innerHTML = `
    <button class="service-btn" onclick="sendQuick('finance')">üí∞ Finance</button>
    <button class="service-btn" onclick="sendQuick('legal')">‚öñ Legal & GST</button>
    <button class="service-btn" onclick="sendQuick('land')">üìã Land</button>
    <button class="service-btn" onclick="sendQuick('construction')">üèó Construction</button>
    <button class="service-btn" onclick="sendQuick('security')">üõ° Security</button>
    <button class="service-btn" onclick="sendQuick('repair')">üîß Repair</button>
  `;
  chatBody.appendChild(div);
}

async function sendQuick(text){
  addMsg(text,"user");
  await botReply(text);
}

async function sendMessage(){
  const msg = input.value.trim();
  if(!msg) return;
  addMsg(msg,"user");
  input.value="";
  await botReply(msg);
}

async function botReply(msg){
  const res = await fetch(API+"/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:msg})
  });
  const data = await res.json();
  addMsg(data.response,"bot");

  if(data.pdf_generated){
    addMsg(
      `<a class="pdf-download-btn" target="_blank"
      href="${API}/download-pdf/${data.pdf_file}">
      üìÑ Download PDF</a>`,"bot");
  }
}

addMsg("üëã Welcome to FastSewa! Please select a service below üëá","bot");
showServiceButtons();
</script>

</body>
</html>
